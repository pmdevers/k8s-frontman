name: Determine Version

on:
  workflow_call:
    outputs:
      version:
        description: 'Computed version string'
        value: ${{ jobs.version.outputs.version }}

jobs:
  version:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
    steps:
      - name: Determine version
        id: version
        run: |
          if [[ "${{ github.ref }}" == refs/tags/v* ]]; then
            # Tag build - use tag name
            VERSION="${{ github.ref_name }}"
          else
            # Branch build - use dev version with short SHA
            VERSION="0.0.0-dev-${{ github.sha }}"
            VERSION="${VERSION:0:24}"  # Keep it reasonably short
          fi
          echo "version=${VERSION}" >> $GITHUB_OUTPUT
          echo "Building version: ${VERSION}"
